<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>ç¬¬å››å…³ï¼šé€»è¾‘æ‹†å¼¹ä¸“å®¶</title>
    <style>
        body { font-family: 'Courier New', monospace; background: #c0c0c0; text-align: center; }
        h1 { color: #000; }
        #game-container {
            display: inline-block;
            background: #bdbdbd;
            border: 3px solid #fff;
            border-right-color: #7b7b7b;
            border-bottom-color: #7b7b7b;
            padding: 10px;
        }
        #grid {
            display: grid;
            grid-template-columns: repeat(9, 30px);
            grid-template-rows: repeat(9, 30px);
            border: 2px solid #7b7b7b;
        }
        .cell {
            width: 30px;
            height: 30px;
            background: #bdbdbd;
            border: 3px solid #fff;
            border-right-color: #7b7b7b;
            border-bottom-color: #7b7b7b;
            box-sizing: border-box;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .cell.revealed {
            border: 1px solid #7b7b7b;
            background: #bdbdbd;
            cursor: default;
        }
        .cell.mine { background-color: red; }
        /* ä¸åŒæ•°å­—çš„é¢œè‰² */
        .n1 { color: blue; } .n2 { color: green; } .n3 { color: red; }
    </style>
</head>
<body>

    <h1>ç¬¬å››å…³ï¼šæ‰«é›·</h1>
    <p>æ¸…é™¤æ‰€æœ‰åœ°é›·ï¼ŒçœŸç›¸å°±åœ¨åºŸå¢Ÿä¹‹ä¸‹ã€‚</p >

    <div id="game-container">
        <div id="grid"></div>
    </div>

    <script>
        const rows = 9;
        const cols = 9;
        const minesCount = 10;
        let mines = [];
        let revealedCount = 0;

        const grid = document.getElementById('grid');

        // åˆå§‹åŒ–ç½‘æ ¼
        function init() {
            // ç”Ÿæˆåœ°é›·ä½ç½®
            let positions = Array.from({length: rows * cols}, (_, i) => i);
            positions.sort(() => Math.random() - 0.5);
            mines = positions.slice(0, minesCount);

            for (let i = 0; i < rows * cols; i++) {
                const cell = document.createElement('div');
                cell.classList.add('cell');
                cell.dataset.index = i;
                cell.addEventListener('click', () => reveal(i));
                // å³é”®æ ‡è®°æ——å¸œï¼ˆå¯é€‰ï¼‰
                cell.addEventListener('contextmenu', (e) => {
                    e.preventDefault();
                    if (!cell.classList.contains('revealed')) {
                        cell.innerText = cell.innerText === 'ğŸš©' ? '' : 'ğŸš©';
                    }
                });
                grid.appendChild(cell);
            }
        }

        function reveal(index) {
            const cell = grid.children[index];
            if (cell.classList.contains('revealed')) return;

            if (mines.includes(index)) {
                alert('ğŸ’¥ ç‚¸äº†ï¼å†æ¥ä¸€æ¬¡å§ï¼');
                location.reload();
                return;
            }

            const mineCount = countMines(index);
            cell.classList.add('revealed');
            revealedCount++;

            if (mineCount > 0) {
                cell.innerText = mineCount;
                cell.classList.add('n' + mineCount);
            } else {
                // å¦‚æœå‘¨å›´æ²¡é›·ï¼Œè‡ªåŠ¨å±•å¼€
                const neighbors = getNeighbors(index);
                neighbors.forEach(n => reveal(n));
            }

            // èƒœåˆ©åˆ¤å®š
            if (revealedCount === rows * cols - minesCount) {
                // è¿™é‡Œè®¾ç½®ä½ çš„ä¸‹ä¸€å…³ç­”æ¡ˆï¼
                alert('æ­å–œé€šå…³ï¼ä¸‹ä¸€å…³çš„å¯†é’¥æ˜¯ï¼šmusic');
                // æˆ–è€…ç›´æ¥è·³è½¬ï¼š window.location.href = '../music';
            }
        }

        function countMines(index) {
            return getNeighbors(index).filter(n => mines.includes(n)).length;
        }

        function getNeighbors(index) {
            const r = Math.floor(index / cols);
            const c = index % cols;
            let neighbors = [];
            for (let i = -1; i <= 1; i++) {
                for (let j = -1; j <= 1; j++) {
                    if (i === 0 && j === 0) continue;
                    if (r + i >= 0 && r + i < rows && c + j >= 0 && c + j < cols) {
                        neighbors.push((r + i) * cols + (c + j));
                    }
                }
            }
            return neighbors;
        }

        init();
    </script>
</body>
</html>
